{% load static %}
<!DOCTYPE html>
<html lang="en" class="transition-colors duration-500">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{% block title %}Adopt Me{% endblock %}</title>
  <link rel="icon" href="{% static 'img/favicon.ico' %}">
  <meta name="description" content="Find and adopt pets near you.">

  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            background: '#f8fafc',
            surface: '#ffffff',
            border: '#e2e8f0',
            text: '#0f172a',
            accent: '#3b82f6',
            darkbg: '#0d1117',
            darksurface: '#161b22',
            darkborder: '#30363d',
            darktext: '#e6edf3',
          }
        }
      }
    }
  </script>

  <!-- Prevent flash -->
  <script>
    (function() {
      if(localStorage.getItem('theme') === 'dark') {
        document.documentElement.classList.add('dark');
      }
    })();
  </script>
</head>

<body class="bg-background text-text dark:bg-darkbg dark:text-darktext font-sans min-h-screen flex flex-col transition-colors duration-500">

  <!-- Header -->
  <header class="bg-surface dark:bg-darksurface border-b border-border dark:border-darkborder p-4 md:px-10 flex justify-between items-center shadow-sm transition-colors duration-500">
    <h1 class="text-xl font-bold text-accent">Adopt Me</h1>

    <!-- Navigation -->
    <nav class="relative flex items-center space-x-4">

      <!-- Desktop Menu -->
      <div class="hidden md:flex space-x-6 items-center">
        <a href="{% url 'home' %}" class="hover:text-accent transition-colors">Home</a>
        <a href="{% url 'about' %}" class="hover:text-accent transition-colors">About</a>
        <a href="{% url 'posts' %}" class="hover:text-accent transition-colors">Posts</a>

        {% if request.user.is_authenticated %}
          {% if request.user.shelter_profile %}
              <a href="{% url 'shelter_profile' %}" class="hover:text-accent transition-colors">Shelter Profile</a>
          {% else %}
              <a href="{% url 'shelter_register' %}" class="hover:text-accent transition-colors">Become a Shelter</a>
          {% endif %}
          {% if user.is_superuser %}
          <a href="{% url 'dashboard_home' %}" class="hover:text-accent font-semibold">Dashboard</a>
          {% endif %}
        {% endif %}

    

        {% if user.is_authenticated %}
        <a href="{% url 'profile' %}">Profile</a>
        {% else %}
        <a href="{% url 'login' %}">Login</a>
        {% endif %}

        <!-- Desktop Theme Toggle -->
        <button id="theme-toggle" aria-label="Toggle Dark Mode" class="ml-4 w-10 h-10 rounded-full overflow-hidden hover:scale-105 transition-transform duration-300">
          <img id="theme-icon" src="{% static 'img/moon.png' %}" alt="theme toggle" class="w-full h-full object-cover transition-all duration-500">
        </button>
      </div>

      <!-- Mobile Menu & Theme -->
      <div class="md:hidden flex items-center space-x-2">
        <button id="mobile-menu-toggle" aria-label="Open Menu" class="p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">☰</button>
        <button id="theme-toggle-mobile" aria-label="Toggle Dark Mode" class="w-10 h-10 rounded-full overflow-hidden hover:scale-105 transition-transform duration-300">
          <img id="theme-icon-mobile" src="{% static 'img/moon.png' %}" alt="theme toggle" class="w-full h-full object-cover transition-all duration-500">
        </button>
      </div>

      <!-- Mobile Menu -->
      <div id="mobile-menu" class="hidden absolute right-0 mt-2 w-48 bg-surface dark:bg-darksurface border border-border dark:border-darkborder rounded-lg shadow-lg flex flex-col p-2 space-y-2 transition-all duration-300">
        <a href="{% url 'home' %}" class="hover:text-accent transition-colors">Home</a>
        <a href="{% url 'about' %}" class="hover:text-accent transition-colors">About</a>
        <a href="{% url 'posts' %}" class="hover:text-accent transition-colors">Posts</a>

        {% if request.user.is_authenticated %}
          <span class="text-sm dark:text-darktext">Hi, {{ request.user.first_name }}!</span>
          <a href="{% url 'logout' %}" class="hover:text-accent transition-colors">Logout</a>
        {% else %}
          <a href="{% url 'login' %}" class="hover:text-accent transition-colors">Login</a>
        {% endif %}
      </div>
    </nav>
  </header>

  <!-- Main Content -->
  <main class="flex-grow transition-colors duration-500">
    {% block content %}{% endblock %}
  </main>

  <!-- Footer -->
  <footer class="text-center text-sm text-gray-500 dark:text-gray-400 border-t border-border dark:border-darkborder py-6 mt-10 transition-colors duration-500">
    &copy; {% now "Y" %} Adopt Me | Made by ผู้ดีBangkok
  </footer>

  <!-- Scripts -->
  <script>
    const root = document.documentElement;

    // Theme icons
    const moonIcon = "{% static 'img/moon.png' %}";
    const sunIcon = "{% static 'img/sun.png' %}";

    const themeDesktop = document.getElementById('theme-toggle');
    const iconDesktop = document.getElementById('theme-icon');
    const themeMobile = document.getElementById('theme-toggle-mobile');
    const iconMobile = document.getElementById('theme-icon-mobile');

    // Set theme icons
    if(localStorage.getItem('theme') === 'dark') {
      if(iconDesktop) iconDesktop.src = moonIcon;
      if(iconMobile) iconMobile.src = moonIcon;
    } else {
      if(iconDesktop) iconDesktop.src = sunIcon;
      if(iconMobile) iconMobile.src = sunIcon;
    }

    // Toggle function
    function toggleTheme() {
      root.classList.toggle('dark');
      const isDark = root.classList.contains('dark');
      localStorage.setItem('theme', isDark ? 'dark' : 'light');
      if(iconDesktop) iconDesktop.src = isDark ? moonIcon : sunIcon;
      if(iconMobile) iconMobile.src = isDark ? moonIcon : sunIcon;
    }

    if(themeDesktop) themeDesktop.addEventListener('click', toggleTheme);
    if(themeMobile) themeMobile.addEventListener('click', toggleTheme);

    // Mobile menu
    const mobileMenuBtn = document.getElementById('mobile-menu-toggle');
    const mobileMenu = document.getElementById('mobile-menu');
    mobileMenuBtn.addEventListener('click', () => mobileMenu.classList.toggle('hidden'));

    document.addEventListener('click', (e) => {
      if (!mobileMenu.contains(e.target) && !mobileMenuBtn.contains(e.target)) {
        mobileMenu.classList.add('hidden');
      }
    });
  </script>
</body>
</html>
