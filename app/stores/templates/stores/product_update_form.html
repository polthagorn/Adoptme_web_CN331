{% extends "base.html" %}

{% block title %}Edit the product - {{ block.super }}{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto bg-surface dark:bg-darksurface p-8 rounded-lg shadow-md border border-border dark:border-darkborder">
    <form method="POST" id="profile-edit-form" enctype="multipart/form-data">
        {% csrf_token %}
        <fieldset>
            <legend class="text-2xl font-bold text-text dark:text-darktext border-b border-border dark:border-darkborder pb-4 mb-6">Edit "{{ product.name }}"</legend>
            
            <!-- loop -->
            {% for field in form %}
                <div class="mb-5">
                    <label for="{{ field.id_for_label }}" class="block mb-2 text-sm font-medium text-text dark:text-darktext">{{ field.label }}</label>
                    {{ field }}
                    {% if field.errors %}
                        <div class="text-red-500 text-sm mt-1">
                            {% for error in field.errors %}
                                <p>{{ error }}</p>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>
            {% endfor %}

        </fieldset>

        <div class="mt-6">
            <button type="button" id="save-changes-btn" class="w-full text-white bg-accent hover:bg-blue-700 font-medium rounded-lg text-sm px-5 py-2.5 text-center transition-colors">
                Save Changes
            </button>
            
            <!-- discard -->
            <a href="{% url 'store_manage' pk=store.pk %}" class="block w-full text-center text-text dark:text-darktext bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 font-medium rounded-lg text-sm px-5 py-2.5 transition-colors">
                Back to Store (Discard Changes)
            </a>
        </div>
    </form>

</div>

<!-- ================================================== -->
<!-- Model for save changes-->
<!-- ================================================== -->
<div id="confirmation-modal" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 hidden">
    <div class="bg-surface dark:bg-darksurface p-6 rounded-lg shadow-xl max-w-sm mx-auto border border-border dark:border-darkborder">
        <h3 class="text-lg font-bold text-text dark:text-darktext">Confirm Changes</h3>
        <p class="mt-2 text-sm text-gray-600 dark:text-gray-400">Are you sure you want to save these changes to your Product?</p>
        <div class="mt-6 flex justify-end space-x-3">
            <button type="button" id="cancel-btn" class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-200 hover:bg-gray-300 dark:bg-gray-600 dark:text-gray-200 dark:hover:bg-gray-500 rounded-md">
                Cancel
            </button>
            <button type="button" id="confirm-btn" class="px-4 py-2 text-sm font-medium text-white bg-accent hover:bg-blue-700 rounded-md">
                Confirm & Save
            </button>
        </div>
    </div>
</div>

<!-- ================================================== -->
<!-- javascript for save changes model           -->
<!-- ================================================== -->
<script>
    // element references
    const saveChangesBtn = document.getElementById('save-changes-btn');
    const confirmationModal = document.getElementById('confirmation-modal');
    const cancelBtn = document.getElementById('cancel-btn');
    const confirmBtn = document.getElementById('confirm-btn');
    const profileEditForm = document.getElementById('profile-edit-form');

    // hit save changes button
    saveChangesBtn.addEventListener('click', () => {
        confirmationModal.classList.remove('hidden');
    });

    // hit cancel button
    cancelBtn.addEventListener('click', () => {
        confirmationModal.classList.add('hidden');
    });

    // hit confirm button
    confirmBtn.addEventListener('click', () => {
        profileEditForm.submit();
    });

    // close modal when clicking outside
    confirmationModal.addEventListener('click', (event) => {
        if (event.target === confirmationModal) {
            confirmationModal.classList.add('hidden');
        }
    });
</script>
{% endblock content %}

